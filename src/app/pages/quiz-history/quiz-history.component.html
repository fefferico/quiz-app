<!-- src/app/pages/quiz-history/quiz-history.component.html -->
<div class="max-w-4xl mx-auto p-4 sm:p-6">
  <header class="mb-8 text-center">
    <h1 class="text-3xl sm:text-4xl font-bold text-indigo-700">Storico Quiz</h1>
    <p class="text-gray-600 mt-1">Rivedi le tue prestazioni passate.</p>
  </header>

  <div *ngIf="isLoading" class="text-center py-10">
    <p class="text-xl text-indigo-600">Caricamento dello storico...</p>
  </div>

  <div *ngIf="errorLoading && !isLoading" class="text-center py-10 bg-red-50 p-6 rounded-lg shadow">
    <p class="text-2xl text-red-700 font-semibold">Errore!</p>
    <p class="text-gray-700 mt-2">{{ errorLoading }}</p>
  </div>

  <div *ngIf="!isLoading && !errorLoading">
    <div *ngIf="quizAttempts.length > 0; else noHistory" class="space-y-4">
      <div class="text-right mb-4" *ngIf="quizAttempts.length > 1">
        <button (click)="clearAllHistory()"
          class="bg-red-500 hover:bg-red-700 text-white text-sm font-medium py-2 px-4 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
          Cancella tutto lo storico quiz
        </button>
      </div>
      <div *ngFor="let attempt of quizAttempts" (click)="viewResults(attempt.id)"
        class="bg-white p-4 sm:p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-150 cursor-pointer border border-gray-200 flex flex-col sm:flex-row justify-between items-start sm:items-center">

        <div class="flex-grow mb-3 sm:mb-0">
          <p class="text-sm text-indigo-600 font-semibold">
            {{ attempt.timestampEnd | date:'d/MM/yyyy':'it-IT' }} alle {{ attempt.timestampEnd | date:'H:mm' }}
          </p>
          <p class="text-lg font-bold text-gray-800 mt-1">
            Punteggio: {{ attempt.score }} / {{ attempt.totalQuestionsInQuiz }}
            <span class="text-gray-600 font-normal">
              ({{ ((attempt?.score ?? 1) / (attempt?.totalQuestionsInQuiz ?? 1) * 100) | number:'1.0-0' }}%)
            </span>
          </p>
          <p class="text-xs text-gray-500 mt-1">
            Argomenti: {{ getTopicsSummary(attempt.settings.selectedTopics) }} |
            {{ attempt.settings.numQuestions }} Domande
          </p>
        </div>

        <div class="flex-shrink-0">
          <button (click)="deleteAttempt(attempt.id, $event)" aria-label="Elimina questo tentativo quiz"
            class="text-red-500 hover:text-red-700 focus:outline-none p-2 rounded-full hover:bg-red-100 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <ng-template #noHistory>
      <div class="text-center py-12 bg-gray-50 rounded-lg shadow">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24"
          stroke="currentColor" stroke-width="1">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <h2 class="mt-4 text-xl font-semibold text-gray-700">Nessuno storico quiz trovato</h2>
        <p class="mt-1 text-gray-500">Sembra che tu non abbia completato alcun quiz.</p>
        <div class="mt-6">
          <a routerLink="/quiz/setup"
            class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md shadow-sm">
            Fai il tuo primo quiz!
          </a>
        </div>
      </div>
    </ng-template>
  </div>

  <div class="mt-8 text-center" *ngIf="!isLoading && !errorLoading">
    <a routerLink="/home"
      class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:shadow-lg transition duration-150 mr-4">
      Torna alla pagina principale
    </a>
  </div>
</div>